<html lang="de" xmlns:f="http://typo3.org/ns/TYPO3/Fluid/ViewHelpers"
      xmlns:="http://typo3.org/ns/KayStrobach/VisualSearch/ViewHelpers"
      xmlns:custom="http://typo3.org/ns/KayStrobach/Custom/ViewHelpers"
      xmlns:media="http://typo3.org/ns/Neos/Media/ViewHelpers"
      xmlns:b="http://typo3.org/ns/KayStrobach/Backend/ViewHelpers"
      xmlns:bs="http://typo3.org/ns/KayStrobach/Bootstrap/ViewHelpers"
      xmlns:cb="http://typo3.org/ns/FourViewture/KIS/CRM/Backend/ViewHelpers"
      xmlns:search="http://typo3.org/ns/KayStrobach/VisualSearch/ViewHelpers"
      xmlns:i="http://typo3.org/ns/KayStrobach/IconRegistry/ViewHelpers"
      data-namespace-typo3-fluid="true"
>

<f:render partial="Components/Panel" arguments="{heading:'Fälligkeiten', object:object}" contentAs="body">
    <div class="table-responsive-lg">
        <table class="table table-striped table-bordered ">
            <cols>
                <col width="15%">
                <col width="5%">
                <col width="*">
                <col width="15%">
                <col width="5%">
            </cols>
            <thead>
            <tr>
                <th>
                    Fälligkeit
                </th>
                <th>
                    Bezahlt
                </th>
                <th>
                    Kommentar
                </th>
                <th class="text-right">
                    Summe
                </th>
                <th class="text-end">
                    <f:if condition="!{object.notChangeable}">
                        <f:if condition="!{objectIsNew}">
                            <f:then>
                                <f:form.button class="btn btn-success btn-xs pull-right" formaction="{f:uri.action(action: 'addSettlementDate')}">
                                    <i:icon name="add"/>
                                </f:form.button>
                            </f:then>
                            <f:else>
                                <f:form.button class="btn btn-success btn-xs pull-right" formaction="{f:uri.action(action: 'addSettlementDate')}" disabled="disabled" title="Erst speichern">
                                    <i:icon name="add"/>
                                </f:form.button>
                            </f:else>
                        </f:if>
                    </f:if>
                </th>
            </tr>
            </thead>
            <tbody>
            <f:for each="{object.settlementDates}" as="settlementDate" iteration="iteration">
                <tr class="{f:if(condition: iteration.isOdd, then:'active')}">
                    <td>
                        <f:render partial="Form/Date" arguments="{property:'settlementDates.{iteration.index}.dueDate', decimals:0, noEdit:object.notChangeable}"/>
                    </td>
                    <td>
                        <f:render partial="Form/CheckboxSwitch" arguments="{property:'settlementDates.{iteration.index}.paid'}" />
                    </td>
                    <td>
                        <f:render partial="Form/TextareaMarkdown" arguments="{property:'settlementDates.{iteration.index}.comment', noEdit:object.notChangeable}"/>
                    </td>
                    <td>
                        <f:render partial="Form/NumberMoney" arguments="{property:'settlementDates.{iteration.index}.amount', noEdit:object.notChangeable}"/>
                    </td>
                    <td class="text-end">
                        <f:if condition="!{object.notChangeable}">
                            <f:form.button class="btn btn-danger btn-xs pull-right" data="{confirm-text:'Eintrag löschen?'}" formaction="{f:uri.action(action: 'removeSettlementDate', arguments: {item:settlementDate})}">
                                <i:icon name="remove" />
                            </f:form.button>
                        </f:if>
                    </td>
                </tr>
            </f:for>
            </tbody>
        </table>
    </div>
</f:render>
