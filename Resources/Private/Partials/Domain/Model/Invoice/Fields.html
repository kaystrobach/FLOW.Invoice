<html lang="de" xmlns:f="http://typo3.org/ns/TYPO3/Fluid/ViewHelpers"
      xmlns:="http://typo3.org/ns/KayStrobach/VisualSearch/ViewHelpers"
      xmlns:custom="http://typo3.org/ns/KayStrobach/Custom/ViewHelpers"
      xmlns:media="http://typo3.org/ns/Neos/Media/ViewHelpers"
      xmlns:b="http://typo3.org/ns/KayStrobach/Backend/ViewHelpers"
      xmlns:bs="http://typo3.org/ns/KayStrobach/Bootstrap/ViewHelpers"
      xmlns:cb="http://typo3.org/ns/FourViewture/KIS/CRM/Backend/ViewHelpers"
      xmlns:search="http://typo3.org/ns/KayStrobach/VisualSearch/ViewHelpers"
      xmlns:i="http://typo3.org/ns/KayStrobach/IconRegistry/ViewHelpers"
      data-namespace-typo3-fluid="true"
>
<f:if condition="{object.changeable}">
    <b:be.button.saveButton/>
    <f:if condition="!{objectIsNew}">
        <b:be.button.addButton type="submit" action="finalize" icon="bootstrap-check" label="Rechnung festschreiben"
                               arguments="{object:object}"/>
        <f:form.hidden property="changeable"/>
        <f:form.hidden property="number.prefix"/>
    </f:if>
</f:if>

<pre>
    * @todo standard mail text
    * @todo Zahlungsbedinung vom Kunden auslesen
    * @todo Angebotsnummer
    * @todo Beauftragungsdatum
    * @todo Kundenreferenz
    * @todo Fälligkeitautomatisch erstellen und dann mit dem Rechnungsbetrag befüllen, das Fälligkeitsdatum wird mit dem Rechnungsdatum erstellt
    * kopie an ausgangsrechnungsjournal@4viewture.de
    * reply-to an?
    * Bei Typ Dauerrechnung auch den Ersatz angeben
</pre>

<bs:tab.tabWrapper>
    <bs:tab.tabPane title="Allgemein">
        <f:render partial="Form/Text" arguments="{label:'Titel', property:'title', noEdit:object.notChangeable}"/>
        <f:render partial="Form/Text"
                  arguments="{label:'Untertitel', property:'subTitle', noEdit:object.notChangeable}"/>
        <f:render partial="Form/TextareaMarkdown"
                  arguments="{label:'Zusatzinformationen', property:'additionalInformation', noEdit:object.notChangeable}"/>
    </bs:tab.tabPane>
    <bs:tab.tabPane title="Kunde">
        <pre>
            @todo Kundennummer
            @todo bearbeiter
            @todo rechnungskreis auswählen
            @todo text dauerrechnungen
        </pre>
        <f:render partial="Domain/Embeddable/AddressEmbeddable" arguments="{prefix:'customer'}" />
    </bs:tab.tabPane>
    <bs:tab.tabPane title="Verkäufer">
        <div class="alert alert-info">
            Die Informationen hier werden zentral verwaltet, müssen jedoch an jeder Rechnung persistiert werden.
        </div>
        <f:render partial="Domain/Embeddable/AddressEmbeddable" arguments="{prefix:'seller'}" />
    </bs:tab.tabPane>
    <bs:tab.tabPane title="Leistungszeitraum">
        <div class="row">
            <div class="col-sm-3">
                <f:render partial="Form/Date"
                          arguments="{label: 'Start', property:'periodOfPerformance.start', noEdit:object.notChangeable}"/>
                <f:render partial="Form/Date"
                          arguments="{label: 'Ende', property:'periodOfPerformance.end', noEdit:object.notChangeable}"/>
            </div>
            <div class="col-sm-9">
                <f:render partial="Form/TextareaMarkdown"
                          arguments="{label:'Leistungszeitraum', property:'periodOfPerformance.comment', noEdit:object.notChangeable, hint:'@todo entfernen'}"/>
            </div>
        </div>
    </bs:tab.tabPane>
    <bs:tab.tabPane title="Zusatztexte">
        <f:render partial="Form/TextareaMarkdown"
                  arguments="{label:'Zusatztext', property:'additionalText', noEdit:object.notChangeable, hint:'@todo wird aus der Registry befüllt, ggf. auch auswahl erlauben'}"/>
    </bs:tab.tabPane>
    <bs:tab.tabPane title="Statusinformationen">
        <f:render partial="Form/Textarea"
                  arguments="{label:'Versandstatus', property:'additionalText', noEdit:object.notChangeable, noEdit:1}"/>
    </bs:tab.tabPane>
    <bs:tab.tabPane title="Tags ({object.tags -> f:count()})">
        <f:render partial="Domain/Model/Tags/Edit" arguments="{tags:tags}" />
    </bs:tab.tabPane>
</bs:tab.tabWrapper>

<f:if condition="{object.invoiceItems}">
    <f:then>
        <f:render partial="Domain/Model/InvoiceItem/Table" arguments="{_all}"/>
    </f:then>
    <f:else>
        <div class="alert alert-info mt-3">
            <f:if condition="!{object.notChangeable}">
                <f:if condition="!{objectIsNew}">
                    <f:then>
                        <f:form.button class="btn btn-success btn-xs pull-right"
                                       formaction="{f:uri.action(action: 'addInvoiceItem')}">
                            <i:icon name="add"/>
                            Rechnungsposition hinzufügen
                        </f:form.button>
                    </f:then>
                    <f:else>
                        <f:form.button class="btn btn-success btn-xs pull-right"
                                       formaction="{f:uri.action(action: 'addInvoiceItem')}" disabled="disabled"
                                       title="Erst speichern">
                            <i:icon name="add"/>
                            Rechnungsposition hinzufügen
                        </f:form.button>
                    </f:else>
                </f:if>
            </f:if>
        </div>
    </f:else>
</f:if>

<f:if condition="{object.settlementDates}">
    <f:then>
        <f:render partial="Domain/Model/SettlementDates/Table" arguments="{_all}"/>
    </f:then>
    <f:else>
        <div class="alert alert-info mt-3">
            <f:if condition="!{object.notChangeable}">
                <f:if condition="!{objectIsNew}">
                    <f:then>
                        <f:form.button class="btn btn-success btn-xs pull-right"
                                       formaction="{f:uri.action(action: 'addSettlementDate')}">
                            <i:icon name="add"/>
                            Fälligkeitsdatum hinzufügen
                        </f:form.button>
                    </f:then>
                    <f:else>
                        <f:form.button class="btn btn-success btn-xs pull-right"
                                       formaction="{f:uri.action(action: 'addSettlementDate')}" disabled="disabled"
                                       title="Erst speichern">
                            <i:icon name="add"/>
                            Fälligkeitsdatum hinzufügen
                        </f:form.button>
                    </f:else>
                </f:if>
            </f:if>
        </div>
    </f:else>
</f:if>



