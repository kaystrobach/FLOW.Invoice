<html lang="de" xmlns:f="http://typo3.org/ns/TYPO3/Fluid/ViewHelpers"
			xmlns:="http://typo3.org/ns/KayStrobach/VisualSearch/ViewHelpers"
			xmlns:custom="http://typo3.org/ns/KayStrobach/Custom/ViewHelpers"
			xmlns:media="http://typo3.org/ns/Neos/Media/ViewHelpers"
			xmlns:b="http://typo3.org/ns/KayStrobach/Backend/ViewHelpers"
			xmlns:bs="http://typo3.org/ns/KayStrobach/Bootstrap/ViewHelpers"
			xmlns:cb="http://typo3.org/ns/FourViewture/KIS/CRM/Backend/ViewHelpers"
			xmlns:search="http://typo3.org/ns/KayStrobach/VisualSearch/ViewHelpers"
			xmlns:i="http://typo3.org/ns/KayStrobach/IconRegistry/ViewHelpers"
			data-namespace-typo3-fluid="true"
>

<f:render partial="Components/Panel" arguments="{heading:'Positionen', object:object}" contentAs="body">
	<div class="table-responsive-lg">
		<table class="table table-striped table-bordered ">
			<cols>
				<col width="7%">
                <col width="7%">
				<col width="*">
				<col width="7%">
				<col width="7%">
				<col width="7%">
				<col width="15%">
				<col width="15%">
				<col width="5%">
			</cols>
			<thead>
			<tr>
				<th>
					Pos
				</th>
                <th>
                    Artikel-Nr.
                </th>
				<th>
					Artikelbezeichnung
				</th>
				<th class="text-right">
					Menge
				</th>
				<th>
					Mengeneinheit
				</th>
				<th class="text-right">
					Steuersatz
                    @todo fest aus den vorgaben erstellen
				</th>
				<th class="text-right">
					Einzelpreis
				</th>
				<th>
					Gesamtpreis
				</th>
				<th class="text-end">
					<f:if condition="!{object.notChangeable}">
						<f:if condition="!{objectIsNew}">
							<f:then>
								<f:form.button class="btn btn-success btn-xs pull-right" formaction="{f:uri.action(action: 'addInvoiceItem')}">
									<i:icon name="add"/>
								</f:form.button>
							</f:then>
							<f:else>
								<f:form.button class="btn btn-success btn-xs pull-right" formaction="{f:uri.action(action: 'addInvoiceItem')}" disabled="disabled" title="Erst speichern">
									<i:icon name="add"/>
								</f:form.button>
							</f:else>
						</f:if>
					</f:if>
				</th>
			</tr>
			</thead>
			<tbody>
			<f:for each="{object.invoiceItems}" as="invoiceItem" iteration="iteration">
				<tr class="{f:if(condition: iteration.isOdd, then:'active')}">
					<td>
                        <f:render partial="Form/Number" arguments="{property:'invoiceItems.{iteration.index}.sort', decimals:0, noEdit:object.notChangeable}"/>
					</td>
                    <td>
                        <f:render partial="Form/Text" arguments="{property:'invoiceItems.{iteration.index}.articleReference', datalist:articleReferenceList}" />
                    </td>
					<td>
						<f:render partial="Form/Text" arguments="{property:'invoiceItems.{iteration.index}.name', decimals:0, noEdit:object.notChangeable}"/>
						<details {f:if(condition:invoiceItem.description, then:'open')}>
							<summary>
								Artikelzusatztext
							</summary>
							<f:render partial="Form/TextareaMarkdown" arguments="{property:'invoiceItems.{iteration.index}.description', decimals:0, noEdit:object.notChangeable}"/>
						</details>
					</td>
					<td>
						<f:render partial="Form/Number" arguments="{property:'invoiceItems.{iteration.index}.amount', decimals:0, noEdit:object.notChangeable}"/>
					</td>
					<td>
                        <f:render partial="Form/SelectSingle" arguments="{property:'invoiceItems.{iteration.index}.unit', options:invoiceItem.possibleUnits, noEdit:object.notChangeable}"/>
					</td>
					<td>
						<f:render partial="Form/Number" arguments="{property:'invoiceItems.{iteration.index}.tax', decimals:2, noEdit:object.notChangeable}"/>
					</td>
					<td>
						<f:render partial="Form/NumberMoney" arguments="{property:'invoiceItems.{iteration.index}.singlePrice', noEdit:object.notChangeable}"/>
					</td>
					<td>
						<f:render partial="Form/NumberMoney" arguments="{property:'invoiceItems.{iteration.index}.total', noEdit:1}"/>
					</td>
					<td class="text-end">
						<f:if condition="!{object.notChangeable}">
							<f:form.button class="btn btn-danger btn-xs pull-right" data="{confirm-text:'Eintrag lÃ¶schen?'}" formaction="{f:uri.action(action: 'removeInvoiceItem', arguments: {item:invoiceItem})}">
								<i:icon name="remove" />
							</f:form.button>
						</f:if>
					</td>
				</tr>
			</f:for>
			</tbody>
			<tfoot class="table-primary">
			<tr>
				<td colspan="7" class="text-end">
					Netto
				</td>
				<td class="text-end">
                    <f:render partial="Form/NumberMoney" arguments="{property:'totalNoTaxes', noEdit:1}"/>
				</td>
				<td>
					&nbsp;
				</td>
			</tr>
			<f:if condition="{object.taxRecords}">
				<f:for each="{object.taxRecords}" as="taxRecord" iteration="iteration">
					<tr>
						<td colspan="7" class="text-end">
							{taxRecord.taxRate -> f:format.number(decimals:2)} %
						</td>
						<td class="text-end">
							<f:render partial="Form/NumberMoney" arguments="{property:'taxRecords.{iteration.index}.sum', noEdit:1}"/>
						</td>
						<td>
							&nbsp;
						</td>
					</tr>
				</f:for>
			</f:if>
			<tr>
				<th colspan="7" class="text-end">
					Rechnungssumme
				</th>
				<th class="text-end">
					<f:render partial="Form/NumberMoney" arguments="{property:'total', noEdit:1}"/>
				</th>
				<th>
					&nbsp;
				</th>
			</tr>
			</tfoot>
		</table>
	</div>
</f:render>
