<html lang="de" xmlns:f="http://typo3.org/ns/TYPO3/Fluid/ViewHelpers"
			xmlns:="http://typo3.org/ns/KayStrobach/VisualSearch/ViewHelpers"
			xmlns:custom="http://typo3.org/ns/KayStrobach/Custom/ViewHelpers"
			xmlns:media="http://typo3.org/ns/Neos/Media/ViewHelpers"
			xmlns:b="http://typo3.org/ns/KayStrobach/Backend/ViewHelpers"
			xmlns:cb="http://typo3.org/ns/FourViewture/KIS/CRM/Backend/ViewHelpers"
			xmlns:search="http://typo3.org/ns/KayStrobach/VisualSearch/ViewHelpers"
			xmlns:i="http://typo3.org/ns/KayStrobach/IconRegistry/ViewHelpers"
			data-namespace-typo3-fluid="true"
>
	<f:if condition="{object.changeable}">
		<b:be.button.saveButton />
		<f:if condition="objectWasSavedBefore">
			<b:be.button.addButton action="finalize" icon="bootstrap-check" label="Rechnung festschreiben" arguments="{object:object}"/>
			<f:form.hidden property="changeable" />
			<f:form.hidden property="numberPrefix" />
		</f:if>
	</f:if>


	<div class="row">
			<div class="col-sm-6">
					<f:render partial="Components/Panel" arguments="{heading:'Debitor'}" contentAs="body">
							<f:render partial="Form/Textarea" arguments="{label:'Adresse', property:'address', noEdit:object.notChangeable}"/>
							<f:render partial="Form/Text" arguments="{label:'E-Mail', property:'email', noEdit:object.notChangeable}"/>
							<f:render partial="Form/Textarea" arguments="{label:'Debitor', property:'deptor', noEdit:object.notChangeable}"/>
							<f:render partial="Form/Text" arguments="{label:'Debitorennummer', property:'deptorNumber', noEdit:object.notChangeable}"/>
					</f:render>
			</div>
			<div class="col-sm-6">
					<f:render partial="Components/Panel" arguments="{heading:'Informationen'}" contentAs="body">
							<f:render partial="Form/Text" arguments="{label:'Titel', property:'title', noEdit:object.notChangeable}"/>
							<f:render partial="Form/Textarea" arguments="{label:'Zusatzinformationen', property:'additionalInformation', noEdit:object.notChangeable}"/>
					</f:render>
			</div>
	</div>

	<f:render partial="Components/Panel" arguments="{heading:'Positionen', object:object}" contentAs="body">
			<f:render partial="Form/Textarea" arguments="{label:'Text vor der Produktliste', property:'preText', noEdit:object.notChangeable}"/>
			<table class="table table-striped table-bordered ">
					<thead>
							<tr>
									<th>
											Pos
									</th>
									<th>
											Artikel / Beschreibung
									</th>
									<th class="text-right">
											Menge
									</th>
									<th>
											Einheit
									</th>
									<th class="text-right">
											Steuer
									</th>
									<th class="text-right">
											Einzelpreis
									</th>
									<th class="text-end">
											<f:if condition="!{object.notChangeable}">
												<f:if condition="{objectWasSavedBefore}">
													<f:then>
														<f:form.button class="btn btn-success btn-xs pull-right" formaction="{f:uri.action(action: 'addInvoiceItem')}">
															<i:icon name="add"/>
														</f:form.button>
													</f:then>
													<f:else>
														<f:form.button class="btn btn-success btn-xs pull-right" formaction="{f:uri.action(action: 'addInvoiceItem')}" disabled="disabled" title="Erst speichern">
															<i:icon name="add"/>
														</f:form.button>
													</f:else>
												</f:if>
											</f:if>
									</th>
							</tr>
					</thead>
					<tbody>
							<f:for each="{object.invoiceItems}" as="invoiceItem" iteration="iteration">
									<tr class="{f:if(condition: iteration.isOdd, then:'active')}">
											<td>
													<div class="form-control">
															{iteration.cycle}
													</div>
											</td>
											<td>
													<f:render partial="Form/Text" arguments="{property:'invoiceItems.{iteration.index}.name', decimals:0, noEdit:object.notChangeable}"/>
											</td>
											<td>
													<f:render partial="Form/Number" arguments="{property:'invoiceItems.{iteration.index}.amount', decimals:0, noEdit:object.notChangeable}"/>
											</td>
											<td>
													<f:render partial="Form/Text" arguments="{property:'invoiceItems.{iteration.index}.unit', decimals:0, noEdit:object.notChangeable}"/>
											</td>
											<td>
													<f:render partial="Form/Number" arguments="{property:'invoiceItems.{iteration.index}.tax', decimals:2, noEdit:object.notChangeable}"/>
											</td>
											<td>
													<f:render partial="Form/Number" arguments="{property:'invoiceItems.{iteration.index}.singlePrice', decimals:2, noEdit:object.notChangeable}"/>
											</td>
											<td>
													<f:if condition="!{object.notChangeable}">
															<f:form.button class="btn btn-danger btn-xs pull-right" data="{confirm:1}" formaction="{f:uri.action(action: 'removeInvoiceItem', arguments: {item:invoiceItem}), noEdit:object.notChangeable}">
																<i:icon name="add" />
															</f:form.button>
													</f:if>
											</td>
									</tr>
									<tr class="{f:if(condition: iteration.isOdd, then:'active')}">
											<td style="border-top: none;">
													&nbsp;
											</td>
											<td colspan="5" style="border-top: none;">
													<f:render partial="Form/Textarea" arguments="{property:'invoiceItems.{iteration.index}.description', decimals:0, noEdit:object.notChangeable}"/>
											</td>
											<td style="border-top: none;">
													&nbsp;
											</td>
									</tr>
							</f:for>
					</tbody>
					<tfoot>
							<tr>
									<td colspan="5" class="text-right">
											Netto
									</td>
									<td class="text-right">
											{object.totalNoTaxes -> f:format.number(decimals: 2, decimalSeparator: ',', thousandsSeparator: ',')}
									</td>
									<td>
											&nbsp;
									</td>
							</tr>
							<f:if condition="{object.taxRecords}">
									<f:for each="{object.taxRecords}" as="taxRecord" iteration="iteration">
											<tr>
													<td colspan="5" class="text-right">
															{taxRecord.taxRate -> f:format.number(decimals: 2, decimalSeparator: ',', thousandsSeparator: ',')} % MwSt
													</td>
													<td class="text-right">
															{taxRecord.sum -> f:format.number(decimals: 2, decimalSeparator: ',', thousandsSeparator: ',')}
													</td>
													<td>
															&nbsp;
													</td>
											</tr>
									</f:for>
							</f:if>
							<tr>
									<th colspan="5" class="text-right">
											Rechnungssumme
									</th>
									<th class="text-right">
											{object.total -> f:format.number(decimals: 2, decimalSeparator: ',', thousandsSeparator: ',')}
									</th>
									<th>
											&nbsp;
									</th>
							</tr>
					</tfoot>
			</table>
			<f:render partial="Form/Textarea" arguments="{label:'Text nach der Produktliste', property:'postText', noEdit:object.notChangeable}"/>
	</f:render>

	<f:render partial="Components/Panel" arguments="{heading:'Leistungszeitraum'}" contentAs="body">
			<div class="row">
					<div class="col-sm-6">
							<f:render partial="Form/Textarea" arguments="{label:'Leistungszeitraum', property:'periodOfPerformanceComment', noEdit:object.notChangeable}"/>
					</div>
					<div class="col-sm-6">
							<f:render partial="Form/DateTime" arguments="{label: 'Start', property:'periodOfPerformanceStart', noEdit:object.notChangeable}" />
							<f:render partial="Form/DateTime" arguments="{label: 'Ende', property:'periodOfPerformanceEnd', noEdit:object.notChangeable}" />
					</div>
			</div>
	</f:render>

	<f:render partial="Components/Panel" arguments="{heading:'Zusatzinformationen'}" contentAs="body">
			<f:render partial="Form/Textarea" arguments="{label:'Freitext', property:'additionalText', noEdit:object.notChangeable}"/>
	</f:render>

